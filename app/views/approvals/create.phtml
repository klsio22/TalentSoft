<div class="container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold"><?= $title ?></h1>
        <a href="<?= route('approvals.index') ?>" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
            Back to Approvals
        </a>
    </div>

    <div class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
        <form action="<?= route('approvals.store') ?>" method="post">
            <?php if (\Lib\Authentication\Auth::isAdmin() || \Lib\Authentication\Auth::isHR()) : ?>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="employee_id">
                        Employee
                    </label>
                    <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline <?= isset($errors['employee_id']) ? 'border-red-500' : '' ?>" 
                        id="employee_id" name="employee_id" required>
                        <option value="">Select Employee</option>
                        <?php foreach ($employees as $employee) : ?>
                            <option value="<?= $employee->id ?>" <?= isset($approval->employee_id) && $approval->employee_id == $employee->id ? 'selected' : '' ?>>
                                <?= htmlspecialchars($employee->name) ?>
                            </option>
                        <?php endforeach; ?>
                    </select>
                    <?php if (isset($errors['employee_id'])) : ?>
                        <p class="text-red-500 text-xs italic"><?= $errors['employee_id'] ?></p>
                    <?php endif; ?>
                </div>
            <?php endif; ?>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="project_id">
                    Project
                </label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline <?= isset($errors['project_id']) ? 'border-red-500' : '' ?>" 
                    id="project_id" name="project_id" required>
                    <option value="">Select Project</option>
                    <?php foreach ($projects as $project) : ?>
                        <option value="<?= $project->id ?>" <?= isset($approval->project_id) && $approval->project_id == $project->id ? 'selected' : '' ?>>
                            <?= htmlspecialchars($project->name) ?>
                        </option>
                    <?php endforeach; ?>
                </select>
                <?php if (isset($errors['project_id'])) : ?>
                    <p class="text-red-500 text-xs italic"><?= $errors['project_id'] ?></p>
                <?php endif; ?>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="title">
                    Title
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline <?= isset($errors['title']) ? 'border-red-500' : '' ?>" 
                    id="title" type="text" name="title" placeholder="Approval Request Title" value="<?= $approval->title ?? '' ?>" required>
                <?php if (isset($errors['title'])) : ?>
                    <p class="text-red-500 text-xs italic"><?= $errors['title'] ?></p>
                <?php endif; ?>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="description">
                    Description
                </label>
                <textarea class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline <?= isset($errors['description']) ? 'border-red-500' : '' ?>" 
                    id="description" name="description" placeholder="Detailed description of what needs approval" rows="4" required><?= $approval->description ?? '' ?></textarea>
                <?php if (isset($errors['description'])) : ?>
                    <p class="text-red-500 text-xs italic"><?= $errors['description'] ?></p>
                <?php endif; ?>
            </div>

            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="request_type">
                    Request Type
                </label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline <?= isset($errors['request_type']) ? 'border-red-500' : '' ?>" 
                    id="request_type" name="request_type">
                    <option value="Budget" <?= isset($approval->request_type) && $approval->request_type === 'Budget' ? 'selected' : '' ?>>Budget</option>
                    <option value="Resource" <?= isset($approval->request_type) && $approval->request_type === 'Resource' ? 'selected' : '' ?>>Resource</option>
                    <option value="Schedule" <?= isset($approval->request_type) && $approval->request_type === 'Schedule' ? 'selected' : '' ?>>Schedule</option>
                    <option value="Other" <?= isset($approval->request_type) && $approval->request_type === 'Other' ? 'selected' : '' ?>>Other</option>
                </select>
                <?php if (isset($errors['request_type'])) : ?>
                    <p class="text-red-500 text-xs italic"><?= $errors['request_type'] ?></p>
                <?php endif; ?>
            </div>

            <div class="flex items-center justify-between">
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                    Submit Request
                </button>
            </div>
        </form>
    </div>
</div>
